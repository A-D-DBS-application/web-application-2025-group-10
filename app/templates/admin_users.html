{% extends "base.html" %}
{% block title %}Gebruikersbeheer{% endblock %}
{% block body_class %}page-admin-users{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_users.css') }}">
{% endblock %}
{% block content %}
<div class="container">
    <div class="header">
        <h1>Gebruikersbeheer</h1>
        <a href="{{ url_for('main.admin_dashboard') }}" class="btn">Terug naar dashboard</a>
    </div>

    <div class="flash-messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    {% set css = 'alert-success' if category == 'success' else 'alert-error' if category == 'error' else 'alert-info' %}
                    <div class="alert {{ css }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="card">
        <h3>Nieuwe gebruiker</h3>
        <form action="{{ url_for('main.admin_create_user') }}" method="POST">
            <div class="form-row">
                <div>
                    <label>Naam</label>
                    <input name="naam" required>
                </div>
                <div>
                    <label>Email</label>
                    <input name="email" type="email" required>
                </div>
                <div>
                    <label>Wachtwoord</label>
                    <input name="wachtwoord" type="text" placeholder="Wachtwoord">
                </div>
                <div>
                    <label>Rol</label>
                    <select name="rol">
                        <option value="User">User</option>
                        <option value="Key user">Key user</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
                <div>
                    <label>Businessunit</label>
                    <select name="businessunit">
                        <option value="">Kies businessunit</option>
                        {% for bu in businessunits %}
                        <option value="{{ bu }}">{{ bu }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div style="margin-top:12px;">
                <button type="submit" class="btn">Opslaan</button>
            </div>
        </form>
    </div>

    <div class="card">
        <h3>Bestaande gebruikers</h3>
        <table class="users-table">
            <thead>
                <tr>
                    <th>Naam</th>
                    <th>Email</th>
                    <th>Rol</th>
                    <th>Businessunit</th>
                    <th>Acties</th>
                </tr>
            </thead>
            <tbody>
                {% for u in gebruikers %}
                {% set form_id = "update_user_" ~ u.gebruiker_id %}
                <tr>
                    <td>{{ u.naam }}</td>
                    <td>{{ u.email }}</td>
                    <td>
                        <select name="rol" form="{{ form_id }}">
                            <option value="User" {{ 'selected' if u.rol == 'User' else '' }}>User</option>
                            <option value="Key user" {{ 'selected' if u.rol == 'Key user' else '' }}>Key user</option>
                            <option value="Admin" {{ 'selected' if u.rol == 'Admin' else '' }}>Admin</option>
                        </select>
                    </td>
                    <td>
                        <select name="businessunit" form="{{ form_id }}">
                            <option value="" {% if not u.businessunit_naam %}selected{% endif %}>Geen</option>
                            {% for bu in businessunits %}
                            <option value="{{ bu }}" {% if u.businessunit_naam == bu %}selected{% endif %}>{{ bu }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <form id="{{ form_id }}" action="{{ url_for('main.admin_update_user', user_id=u.gebruiker_id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="small-btn">Opslaan</button>
                        </form>
                        <form action="{{ url_for('main.admin_delete_user', user_id=u.gebruiker_id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="small-btn" onclick="return confirm('Gebruiker verwijderen?');">Verwijderen</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
